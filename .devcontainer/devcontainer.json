// .devcontainer/devcontainer.json
{
  "name": "Hugo, TailwindCSS, and Vite Stack",

  // Use a pre-configured image with many common development tools already installed.
  // This saves time and ensures a consistent base environment.
  "image": "mcr.microsoft.com/devcontainers/universal:latest",

  // Add specific tools to the base image using Dev Container features.
  // This is a more declarative and robust method than manual installation.
  "features": {
    "ghcr.io/devcontainers/features/hugo:1": {},
    "ghcr.io/devcontainers/features/node:1": {
      "version": "lts"
    }
  },

  // Automatically install Node.js dependencies the first time the container is created.
  // This eliminates a manual setup step.
  "postCreateCommand": "npm install",

  // Automatically start the Hugo development server as soon as the container is ready.
  // This is a key optimization for rapid iteration.
  "postAttachCommand": "hugo server -D",

  // Set up volume mounts for persistent caching.
  // This makes container rebuilds extremely fast by preserving the node_modules directory.
  "mounts": [
    "source=node-modules-cache,target=${containerWorkspaceFolder}/node_modules,type=volume"
  ],

  // Configure VS Code extensions for a richer development experience inside the container.
  // This ensures a consistent editor setup across machines.
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.live-server",
        "esbenp.prettier-vscode",
        "bradlc.vscode-tailwindcss",
        "budparr.markdown-preview-enhanced",
        "bungcip.better-toml",
        "zxh404.vscode-yaml"
      ]
    }
  },

  // Define attributes for specific ports.
  // This provides useful labels and custom forwarding behavior.
  "portsAttributes": {
    "1313": {
      "label": "Hugo Server",
      "onAutoForward": "notify"
    },
    "5173": {
      "label": "Vite Server",
      "onAutoForward": "ignore"
    }
  },

  // Automatically forward these ports from the container to your local machine.
  "forwardPorts": [1313, 5173],

  // Specify the user that the container will run as.
  "remoteUser": "vscode"
}